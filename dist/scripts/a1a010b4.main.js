function extend(a,b){var c=function(){};return c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b),a}function propCopy(a,b){for(var c in a)a.hasOwnProperty(c)&&("object"==typeof a[c]&&"object"==typeof b[c]?b[c]=propCopy(a[c],b[c]):b[c]=a[c]);return b}function NOOP(){}function isValidUrl(a){if(!a)return!1;var b,c,d,e=!1;try{b=document.implementation.createHTMLDocument(""),c=b.createElement("base"),c.href=c||window.lo,b.head.appendChild(c),d=b.createElement("a"),d.href=a,b.body.appendChild(d),e=!(""===d.href)}catch(f){console.error(f)}finally{return b.head.removeChild(c),b.body.removeChild(d),c=null,d=null,b=null,e}}function isUUID(a){return a?uuidValueRegex.test(a):!1}function encodeParams(a){var b;return a&&Object.keys(a)&&(b=[].slice.call(arguments).reduce(function(a,b){return a.concat(b instanceof Array?b:[b])},[]).filter(function(a){return"object"==typeof a}).reduce(function(a,b){return b instanceof Array?a.push(b):a=a.concat(Object.keys(b).map(function(a){return[a,b[a]]})),a},[]).reduce(function(a,b){return 2===b.length?a.push(b):a=a.concat(b),a},[]).reduce(function(a,b){return b[1]instanceof Array?b[1].forEach(function(c){a.push([b[0],c])}):a.push(b),a},[]).map(function(a){return a[1]=encodeURIComponent(a[1]),a.join("=")}).join("&")),b}function isFunction(a){return a&&null!==a&&"function"==typeof a}function doCallback(a,b,c){var d;return isFunction(a)&&(b||(b=[]),c||(c=this),b.push(c),d=a.apply(c,b)),d}function getSafeTime(a){var b;switch(typeof a){case"undefined":b=Date.now();break;case"number":b=a;break;case"string":b=isNaN(a)?Date.parse(a):parseInt(a);break;default:b=Date.parse(a.toString())}return b}var UsergridEventable=function(){throw Error("'UsergridEventable' is not intended to be invoked directly")};UsergridEventable.prototype={bind:function(a,b){this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(b)},unbind:function(a,b){this._events=this._events||{},a in this._events!=!1&&this._events[a].splice(this._events[a].indexOf(b),1)},trigger:function(a){if(this._events=this._events||{},a in this._events!=!1)for(var b=0;b<this._events[a].length;b++)this._events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}},UsergridEventable.mixin=function(a){for(var b=["bind","unbind","trigger"],c=0;c<b.length;c++)b[c]in a.prototype&&(console.warn("overwriting '"+b[c]+"' on '"+a.name+"'."),console.warn("the previous version can be found at '_"+b[c]+"' on '"+a.name+"'."),a.prototype["_"+b[c]]=a.prototype[b[c]]),a.prototype[b[c]]=UsergridEventable.prototype[b[c]]},function(){function a(a){this.logEnabled=!0,this.init(a,!0)}var b="Logger",c=this,d=c[b];return a.METHODS=["log","error","warn","info","debug","assert","clear","count","dir","dirxml","exception","group","groupCollapsed","groupEnd","profile","profileEnd","table","time","timeEnd","trace"],a.prototype.init=function(b,c){this.name=b||"UNKNOWN",this.logEnabled=c||!0;var d=function(a){this[a]=this.createLogMethod(a)}.bind(this);a.METHODS.forEach(d)},a.prototype.createLogMethod=function(b){return a.prototype.log.bind(this,b)},a.prototype.prefix=function(a,c){var d="["+a.toUpperCase()+"]["+b+"]:	";return-1!==["log","error","warn","info"].indexOf(a)&&("string"==typeof c[0]?c[0]=d+c[0]:c.unshift(d)),c},a.prototype.log=function(){var b=[].slice.call(arguments);method=b.shift(),-1===a.METHODS.indexOf(method)&&(method="log"),this.logEnabled&&console&&console[method]&&(b=this.prefix(method,b),console[method].apply(console,b))},a.prototype.setLogEnabled=function(a){this.logEnabled=a||!0},a.mixin=function(b){b.__logger=new a(b.name||"UNKNOWN");var c=function(a){a in b.prototype&&(console.warn("overwriting '"+a+"' on '"+b.name+"'."),console.warn("the previous version can be found at '_"+a+"' on '"+b.name+"'."),b.prototype["_"+a]=b.prototype[a]),b.prototype[a]=b.__logger.createLogMethod(a)};a.METHODS.forEach(c)},c[b]=a,c[b].noConflict=function(){return d&&(c[b]=d),a},c[b]}(),function(a){function b(){this.complete=!1,this.error=null,this.result=null,this.callbacks=[]}var c="Promise",d=a[c];return b.prototype.then=function(a,b){var c=function(){return a.apply(b,arguments)};this.complete?c(this.error,this.result):this.callbacks.push(c)},b.prototype.done=function(a,b){if(this.complete=!0,this.error=a,this.result=b,this.callbacks){for(var c=0;c<this.callbacks.length;c++)this.callbacks[c](a,b);this.callbacks.length=0}},b.join=function(a){function c(a){return function(b,c){f+=1,g[a]=b,h[a]=c,f===e&&d.done(g,h)}}for(var d=new b,e=a.length,f=0,g=[],h=[],i=0;e>i;i++)a[i]().then(c(i));return d},b.chain=function(a,c,d){var e=new b;return null===a||0===a.length?e.done(c,d):a[0](c,d).then(function(c,d){a.splice(0,1),a?b.chain(a,c,d).then(function(a,b){e.done(a,b)}):e.done(c,d)}),e},a[c]=b,a[c].noConflict=function(){return d&&(a[c]=d),b},a[c]}(this),function(){function a(){var a=Array.prototype.slice.call(arguments),b=a.shift();return b.bind(this,a)}function b(){function b(a){var b="";if("string"==typeof a)b=a;else{var c=encodeURIComponent;for(var d in a)a.hasOwnProperty(d)&&(b+="&"+c(d)+"="+c(a[d]))}return b}function c(a,c,d){var e,g=new Promise;return f.logger.time(a+" "+c),function(h){h.onreadystatechange=function(){4===this.readyState&&(f.logger.timeEnd(a+" "+c),clearTimeout(e),g.done(null,this))},h.onerror=function(a){clearTimeout(e),g.done(a,null)},h.oncomplete=function(b){clearTimeout(e),f.logger.timeEnd(a+" "+c),f.info("%s request to %s returned %s",a,c,this.status)},h.open(a,c),d&&("object"==typeof d&&(d=JSON.stringify(d)),h.setRequestHeader("Content-Type","application/json"),h.setRequestHeader("Accept","application/json")),e=setTimeout(function(){h.abort(),g.done("API Call timed out.",null)},3e4),h.send(b(d))}(new XMLHttpRequest),g}this.logger=new e.Logger(d);var f=this;this.request=c,this.get=a(c,"GET"),this.post=a(c,"POST"),this.put=a(c,"PUT"),this["delete"]=a(c,"DELETE")}var c,d="Ajax",e=this,f=e[d];return e[d]=new b,e[d].noConflict=function(){return f&&(e[d]=f),c},e[d]}(),window.console=window.console||{},window.console.log=window.console.log||function(){};var uuidValueRegex=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;!function(a){function b(){this.logger=new Logger(c)}var c="Usergrid",d=a[c],e=["GET","POST","PUT","DELETE"];return b.isValidEndpoint=function(a){return!0},b.Request=function(c,d,f,g,h){var i=new Promise;if(this.logger=new a.Logger("Usergrid.Request"),this.logger.time("process request "+c+" "+d),this.endpoint=d+"?"+encodeParams(f),this.method=c.toUpperCase(),this.data="object"==typeof g?JSON.stringify(g):g,-1===e.indexOf(this.method))throw new UsergridInvalidHTTPMethodError("invalid request method '"+this.method+"'");if(!isValidUrl(this.endpoint))throw this.logger.error(d,this.endpoint,/^https:\/\//.test(d)),new UsergridInvalidURIError("The provided endpoint is not valid: "+this.endpoint);var j=function(){return Ajax.request(this.method,this.endpoint,this.data)}.bind(this),k=function(a,c){return new b.Response(a,c)}.bind(this),l=function(a,b){i.done(a,b),this.logger.info("REQUEST",a,b),doCallback(h,[a,b]),this.logger.timeEnd("process request "+c+" "+d)}.bind(this);return Promise.chain([j,k]).then(l),i},b.Response=function(b,d){var e=new Promise,f=null;try{f=JSON.parse(d.responseText)}catch(g){f={}}switch(Object.keys(f).forEach(function(a){Object.defineProperty(this,a,{value:f[a],enumerable:!0})}.bind(this)),Object.defineProperty(this,"logger",{enumerable:!1,configurable:!1,writable:!1,value:new a.Logger(c)}),Object.defineProperty(this,"success",{enumerable:!1,configurable:!1,writable:!0,value:!0}),Object.defineProperty(this,"err",{enumerable:!1,configurable:!1,writable:!0,value:b}),Object.defineProperty(this,"status",{enumerable:!1,configurable:!1,writable:!0,value:parseInt(d.status)}),Object.defineProperty(this,"statusGroup",{enumerable:!1,configurable:!1,writable:!0,value:this.status-this.status%100}),this.statusGroup){case 200:this.success=!0;break;case 400:case 500:case 300:case 100:default:this.success=!1}return this.success?e.done(null,this):e.done(UsergridError.fromResponse(f),this),e},b.Response.prototype.getEntities=function(){var a;return this.success&&(a=this.data?this.data.entities:this.entities),a||[]},b.Response.prototype.getEntity=function(){var a=this.getEntities();return a[0]},b.VERSION=b.USERGRID_SDK_VERSION="0.11.0",a[c]=b,a[c].noConflict=function(){return d&&(a[c]=d),b},a[c]}(this),function(){var a,b="Client",c=this,d=c[b];return Usergrid.Client=function(a){this.URI=a.URI||"https://api.usergrid.com",a.orgName&&this.set("orgName",a.orgName),a.appName&&this.set("appName",a.appName),a.qs&&this.setObject("default_qs",a.qs),this.buildCurl=a.buildCurl||!1,this.logging=a.logging||!1},Usergrid.Client.prototype.request=function(a,b){var c,d=a.method||"GET",e=a.endpoint,f=a.body||{},g=a.qs||{},h=a.mQuery||!1,i=this.get("orgName"),j=this.get("appName"),k=this.getObject("default_qs");if(!h&&!i&&!j)return logoutCallback();c=h?this.URI+"/"+e:this.URI+"/"+i+"/"+j+"/"+e,this.getToken()&&(g.access_token=this.getToken()),k&&(g=propCopy(g,k));var l=this;new Usergrid.Request(d,c,g,f,function(a,c){a?doCallback(b,[a,c,l],l):doCallback(b,[null,c,l],l)})},Usergrid.Client.prototype.buildAssetURL=function(a){var b=this,c={},d=this.URI+"/"+this.orgName+"/"+this.appName+"/assets/"+a+"/data";b.getToken()&&(c.access_token=b.getToken());var e=encodeParams(c);return e&&(d+="?"+e),d},Usergrid.Client.prototype.createGroup=function(a,b){var c=new Usergrid.Group({path:a.path,client:this,data:a});c.save(function(a,d){doCallback(b,[a,d,c],c)})},Usergrid.Client.prototype.createEntity=function(a,b){var c=new Usergrid.Entity({client:this,data:a});c.save(function(a,d){doCallback(b,[a,d,c],c)})},Usergrid.Client.prototype.getEntity=function(a,b){var c=new Usergrid.Entity({client:this,data:a});c.fetch(function(a,d){doCallback(b,[a,d,c],c)})},Usergrid.Client.prototype.restoreEntity=function(a){var b=JSON.parse(a),c={client:this,data:b},d=new Usergrid.Entity(c);return d},Usergrid.Client.prototype.createCounter=function(a,b){var c=new Usergrid.Counter({client:this,data:a});c.save(b)},Usergrid.Client.prototype.createAsset=function(a,b){var c=a.file;c&&(a.name=a.name||c.name,a["content-type"]=a["content-type"]||c.type,a.path=a.path||"/",delete a.file);var d=new Usergrid.Asset({client:this,data:a});d.save(function(a,d,e){c&&!a?e.upload(c,b):doCallback(b,[a,d,e],e)})},Usergrid.Client.prototype.createCollection=function(a,b){return a.client=this,new Usergrid.Collection(a,function(a,c,d){console.log("createCollection",arguments),doCallback(b,[a,d,c])})},Usergrid.Client.prototype.restoreCollection=function(a){var b=JSON.parse(a);b.client=this;var c=new Usergrid.Collection(b);return c},Usergrid.Client.prototype.getFeedForUser=function(a,b){var c={method:"GET",endpoint:"users/"+a+"/feed"};this.request(c,function(a,c){a?doCallback(b,[a]):doCallback(b,[a,c,c.getEntities()])})},Usergrid.Client.prototype.createUserActivity=function(a,b,c){b.type="users/"+a+"/activities",b={client:this,data:b};var d=new Usergrid.Entity(b);d.save(function(a,b){doCallback(c,[a,b,d])})},Usergrid.Client.prototype.createUserActivityWithEntity=function(a,b,c){var d=a.get("username"),e={actor:{displayName:d,uuid:a.get("uuid"),username:d,email:a.get("email"),picture:a.get("picture"),image:{duration:0,height:80,url:a.get("picture"),width:80}},verb:"post",content:b};this.createUserActivity(d,e,c)},Usergrid.Client.prototype.calcTimeDiff=function(){var a=0,b=this._end-this._start;try{a=(b/10/60).toFixed(2)}catch(c){return 0}return a},Usergrid.Client.prototype.setToken=function(a){this.set("token",a)},Usergrid.Client.prototype.getToken=function(){return this.get("token")},Usergrid.Client.prototype.setObject=function(a,b){b&&(b=JSON.stringify(b)),this.set(a,b)},Usergrid.Client.prototype.set=function(a,b){var c="apigee_"+a;this[a]=b,"undefined"!=typeof Storage&&(b?localStorage.setItem(c,b):localStorage.removeItem(c))},Usergrid.Client.prototype.getObject=function(a){return JSON.parse(this.get(a))},Usergrid.Client.prototype.get=function(a){var b="apigee_"+a,c=null;return this[a]?c=this[a]:"undefined"!=typeof Storage&&(c=localStorage.getItem(b)),c},Usergrid.Client.prototype.signup=function(a,b,c,d,e){var f={type:"users",username:a,password:b,email:c,name:d};this.createEntity(f,e)},Usergrid.Client.prototype.login=function(a,b,c){var d=this,e={method:"POST",endpoint:"token",body:{username:a,password:b,grant_type:"password"}};d.request(e,function(a,b){var e={};if(a)d.logging&&console.log("error trying to log user in");else{var f={client:d,data:b.user};e=new Usergrid.Entity(f),d.setToken(b.access_token)}doCallback(c,[a,b,e])})},Usergrid.Client.prototype.reAuthenticateLite=function(a){var b=this,c={method:"GET",endpoint:"management/me",mQuery:!0};this.request(c,function(c,d){c&&b.logging?console.log("error trying to re-authenticate user"):b.setToken(d.data.access_token),doCallback(a,[c])})},Usergrid.Client.prototype.reAuthenticate=function(a,b){var c=this,d={method:"GET",endpoint:"management/users/"+a,mQuery:!0};this.request(d,function(a,d){var e,f={},g={},h={};if(a&&c.logging)console.log("error trying to full authenticate user");else{e=d.data,c.setToken(e.token),c.set("email",e.email),localStorage.setItem("accessToken",e.token),localStorage.setItem("userUUID",e.uuid),localStorage.setItem("userEmail",e.email);var i={username:e.username,email:e.email,name:e.name,uuid:e.uuid},j={client:c,data:i};h=new Usergrid.Entity(j),f=e.organizations;var k="";try{var l=c.get("orgName");k=f[l]?f[l]:f[Object.keys(f)[0]],c.set("orgName",k.name)}catch(m){a=!0,c.logging&&console.log("error selecting org")}g=c.parseApplicationsArray(k),c.selectFirstApp(g),c.setObject("organizations",f),c.setObject("applications",g)}doCallback(b,[a,e,h,f,g],c)})},Usergrid.Client.prototype.loginFacebook=function(a,b){var c=this,d={method:"GET",endpoint:"auth/facebook",qs:{fb_access_token:a}};this.request(d,function(a,d){var e={};if(a&&c.logging)console.log("error trying to log user in");else{var f={client:c,data:d.user};e=new Usergrid.Entity(f),c.setToken(d.access_token)}doCallback(b,[a,d,e],c)})},Usergrid.Client.prototype.getLoggedInUser=function(a){var b=this;if(this.getToken()){var c={method:"GET",endpoint:"users/me"};this.request(c,function(c,d){if(c)b.logging&&console.log("error trying to log user in"),console.error(c,d),doCallback(a,[c,d,b],b);else{var e={client:b,data:d.getEntity()},f=new Usergrid.Entity(e);doCallback(a,[null,d,f],b)}})}else doCallback(a,[new UsergridError("Access Token not set"),null,b],b)},Usergrid.Client.prototype.isLoggedIn=function(){var a=this.getToken();return"undefined"!=typeof a&&null!==a},Usergrid.Client.prototype.logout=function(){this.setToken()},Usergrid.Client.prototype.destroyToken=function(a,b,c,d){var e={client:self,method:"PUT"};c===!0?e.endpoint="users/"+a+"/revoketokens":null===b?e.endpoint="users/"+a+"/revoketoken?token="+this.getToken():e.endpoint="users/"+a+"/revoketoken?token="+b,this.request(e,function(a,b){a?(self.logging&&console.log("error destroying access token"),doCallback(d,[a,b,null],self)):(c===!0?console.log("all user tokens invalidated"):console.log("token invalidated"),doCallback(d,[a,b,null],self))})},Usergrid.Client.prototype.logoutAndDestroyToken=function(a,b,c,d){null===a?console.log("username required to revoke tokens"):(this.destroyToken(a,b,c,d),(c===!0||b===this.getToken()||null===b)&&this.setToken(null))},Usergrid.Client.prototype.buildCurlCall=function(a){var b=["curl"],c=(a.method||"GET").toUpperCase(),d=a.body,e=a.uri;return b.push("-X"),b.push(["POST","PUT","DELETE"].indexOf(c)>=0?c:"GET"),b.push(e),"object"==typeof d&&Object.keys(d).length>0&&-1!==["POST","PUT"].indexOf(c)&&(b.push("-d"),b.push("'"+JSON.stringify(d)+"'")),b=b.join(" "),console.log(b),b},Usergrid.Client.prototype.getDisplayImage=function(a,b,c){c=c||50;var d="https://apigee.com/usergrid/images/user_profile.png";try{b?d=b:a.length&&(d="https://secure.gravatar.com/avatar/"+MD5(a)+"?s="+c+encodeURI("&d=https://apigee.com/usergrid/images/user_profile.png"))}catch(e){}finally{return d}},c[b]=Usergrid.Client,c[b].noConflict=function(){return d&&(c[b]=d),a},c[b]}();var ENTITY_SYSTEM_PROPERTIES=["metadata","created","modified","oldpassword","newpassword","type","activated","uuid"];Usergrid.Entity=function(a){this._data={},this._client=void 0,a&&(this.set(a.data||{}),this._client=a.client||{})},Usergrid.Entity.isEntity=function(a){return a&&a instanceof Usergrid.Entity},Usergrid.Entity.isPersistedEntity=function(a){return isEntity(a)&&isUUID(a.get("uuid"))},Usergrid.Entity.prototype.serialize=function(){return JSON.stringify(this._data)},Usergrid.Entity.prototype.get=function(a){var b;if(0===arguments.length?b=this._data:arguments.length>1&&(a=[].slice.call(arguments).reduce(function(a,b,c,d){return b instanceof Array?a=a.concat(b):a.push(b),a},[])),a instanceof Array){var c=this;b=a.map(function(a){return c.get(a)})}else"undefined"!=typeof a&&(b=this._data[a]);return b},Usergrid.Entity.prototype.set=function(a,b){if("object"==typeof a)for(var c in a)this._data[c]=a[c];else"string"==typeof a?null===b?delete this._data[a]:this._data[a]=b:this._data={}},Usergrid.Entity.prototype.getEndpoint=function(){var a,b=this.get("type"),c=["uuid","name"];if(void 0===b)throw new UsergridError("cannot fetch entity, no entity type specified","no_type_specified");return/^users?$/.test(b)&&c.unshift("username"),a=this.get(c).filter(function(a){return null!==a&&"undefined"!=typeof a}).shift(),a?[b,a].join("/"):b},Usergrid.Entity.prototype.save=function(a){var b=this,c=this.get("type"),d="POST",e=this.get("uuid"),f=this.get(),g={method:d,endpoint:c};e&&(g.method="PUT",g.endpoint+="/"+e),g.body=Object.keys(f).filter(function(a){return-1===ENTITY_SYSTEM_PROPERTIES.indexOf(a)}).reduce(function(a,b){return a[b]=f[b],a},{}),b._client.request(g,function(c,d){var e=d.getEntity();e&&(b.set(e),b.set("type",/^\//.test(d.path)?d.path.substring(1):d.path)),c&&b._client.logging&&console.log("could not save entity"),doCallback(a,[c,d,b],b)})},Usergrid.Entity.prototype.changePassword=function(a,b,c){var d=this;if("function"==typeof a&&void 0===c&&(c=a,a=d.get("oldpassword"),b=d.get("newpassword")),d.set({password:null,oldpassword:null,newpassword:null}),!(/^users?$/.test(d.get("type"))&&a&&b))throw new UsergridInvalidArgumentError("Invalid arguments passed to 'changePassword'");var e={method:"PUT",endpoint:"users/"+d.get("uuid")+"/password",body:{uuid:d.get("uuid"),username:d.get("username"),oldpassword:a,newpassword:b}};d._client.request(e,function(a,b){a&&d._client.logging&&console.log("could not update user"),doCallback(c,[a,b,d],d)})},Usergrid.Entity.prototype.fetch=function(a){var b,c=this;b=this.getEndpoint();var d={method:"GET",endpoint:b};this._client.request(d,function(b,d){var e=d.getEntity();e&&c.set(e),doCallback(a,[b,d,c],c)})},Usergrid.Entity.prototype.destroy=function(a){var b=this,c=this.getEndpoint(),d={method:"DELETE",endpoint:c};this._client.request(d,function(c,d){c||b.set(null),doCallback(a,[c,d,b],b)})},Usergrid.Entity.prototype.connect=function(a,b,c){this.addOrRemoveConnection("POST",a,b,c)},Usergrid.Entity.prototype.disconnect=function(a,b,c){this.addOrRemoveConnection("DELETE",a,b,c)},Usergrid.Entity.prototype.addOrRemoveConnection=function(a,b,c,d){var e=this;if(-1==["POST","DELETE"].indexOf(a.toUpperCase()))throw new UsergridInvalidArgumentError("invalid method for connection call. must be 'POST' or 'DELETE'");var f=c.get("type"),g=this.getEntityId(c);if(!g)throw new UsergridInvalidArgumentError("connectee could not be identified");var h=this.get("type"),i=this.getEntityId(this);if(!i)throw new UsergridInvalidArgumentError("connector could not be identified");var j=[h,i,b,f,g].join("/"),k={method:a,endpoint:j};this._client.request(k,function(a,b){a&&e._client.logging&&console.log("There was an error with the connection call"),doCallback(d,[a,b,e],e)})},Usergrid.Entity.prototype.getEntityId=function(a){var b;return b=isUUID(a.get("uuid"))?a.get("uuid"):"users"===this.get("type")||"user"===this.get("type")?a.get("username"):a.get("name")},Usergrid.Entity.prototype.getConnections=function(a,b){var c=this,d=this.get("type"),e=this.getEntityId(this);if(e){var f=d+"/"+e+"/"+a+"/",g={method:"GET",endpoint:f};this._client.request(g,function(d,e){d&&c._client.logging&&console.log("entity could not be connected"),c[a]={};for(var f=e&&e.entities?e.entities.length:0,g=0;f>g;g++)"user"===e.entities[g].type?c[a][e.entities[g].username]=e.entities[g]:c[a][e.entities[g].name]=e.entities[g];doCallback(b,[d,e,e.entities],c)})}else if("function"==typeof b){var h="Error in getConnections - no uuid specified.";c._client.logging&&console.log(h),doCallback(b,[!0,h],c)}},Usergrid.Entity.prototype.getGroups=function(a){var b=this,c="users/"+this.get("uuid")+"/groups",d={method:"GET",endpoint:c};this._client.request(d,function(c,d){c&&b._client.logging&&console.log("entity could not be connected"),b.groups=d.entities,doCallback(a,[c,d,d.entities],b)})},Usergrid.Entity.prototype.getActivities=function(a){var b=this,c=this.get("type")+"/"+this.get("uuid")+"/activities",d={method:"GET",endpoint:c};this._client.request(d,function(c,d){c&&b._client.logging&&console.log("entity could not be connected");for(var e in d.entities)d.entities[e].createdDate=new Date(d.entities[e].created).toUTCString();b.activities=d.entities,doCallback(a,[c,d,d.entities],b)})},Usergrid.Entity.prototype.getFollowing=function(a){var b=this,c="users/"+this.get("uuid")+"/following",d={method:"GET",endpoint:c};this._client.request(d,function(c,d){c&&b._client.logging&&console.log("could not get user following");for(var e in d.entities){d.entities[e].createdDate=new Date(d.entities[e].created).toUTCString();var f=b._client.getDisplayImage(d.entities[e].email,d.entities[e].picture);d.entities[e]._portal_image_icon=f}b.following=d.entities,doCallback(a,[c,d,d.entities],b)})},Usergrid.Entity.prototype.getFollowers=function(a){var b=this,c="users/"+this.get("uuid")+"/followers",d={method:"GET",endpoint:c};this._client.request(d,function(c,d){c&&b._client.logging&&console.log("could not get user followers");for(var e in d.entities){d.entities[e].createdDate=new Date(d.entities[e].created).toUTCString();var f=b._client.getDisplayImage(d.entities[e].email,d.entities[e].picture);d.entities[e]._portal_image_icon=f}b.followers=d.entities,doCallback(a,[c,d,d.entities],b)})},Usergrid.Client.prototype.createRole=function(a,b,c){var d={type:"role",name:a};this.createEntity(d,function(a,d,e){a?doCallback(c,[a,d,self]):e.assignPermissions(b,function(a,b){a?doCallback(c,[a,d,self]):doCallback(c,[a,b,b.data],self)})})},Usergrid.Entity.prototype.getRoles=function(a){var b=this,c=this.get("type")+"/"+this.get("uuid")+"/roles",d={method:"GET",endpoint:c};this._client.request(d,function(c,d){c&&b._client.logging&&console.log("could not get user roles"),b.roles=d.entities,doCallback(a,[c,d,d.entities],b)})},Usergrid.Entity.prototype.assignRole=function(a,b){var c,d=this,e=d.get("type"),f=e+"s";"user"==e&&null!=this.get("username")?c=d.get("username"):"group"==e&&null!=this.get("name")?c=d.get("name"):null!=this.get("uuid")&&(c=d.get("uuid")),"users"!=e&&"groups"!=e&&doCallback(b,[new UsergridError("entity must be a group or user","invalid_entity_type"),null,this],this);var g="roles/"+a+"/"+f+"/"+c,h={method:"POST",endpoint:g};this._client.request(h,function(a,c){a&&console.log("Could not assign role."),doCallback(b,[a,c,d])})},Usergrid.Entity.prototype.removeRole=function(a,b){var c,d=this,e=d.get("type"),f=e+"s";"user"==e&&null!=this.get("username")?c=this.get("username"):"group"==e&&null!=this.get("name")?c=this.get("name"):null!=this.get("uuid")&&(c=this.get("uuid")),"users"!=e&&"groups"!=e&&doCallback(b,[new UsergridError("entity must be a group or user","invalid_entity_type"),null,this],this);var g="roles/"+a+"/"+f+"/"+c,h={method:"DELETE",endpoint:g};this._client.request(h,function(a,c){a&&console.log("Could not assign role."),doCallback(b,[a,c,d])})},Usergrid.Entity.prototype.assignPermissions=function(a,b){var c,d=this,e=this.get("type");"user"!=e&&"users"!=e&&"group"!=e&&"groups"!=e&&"role"!=e&&"roles"!=e&&doCallback(b,[new UsergridError("entity must be a group, user, or role","invalid_entity_type"),null,this],this),"user"==e&&null!=this.get("username")?c=this.get("username"):"group"==e&&null!=this.get("name")?c=this.get("name"):null!=this.get("uuid")&&(c=this.get("uuid"));var f=e+"/"+c+"/permissions",g={method:"POST",endpoint:f,body:{permission:a}};this._client.request(g,function(a,c){a&&d._client.logging&&console.log("could not assign permissions"),doCallback(b,[a,c,c.data],d)})},Usergrid.Entity.prototype.removePermissions=function(a,b){var c,d=this,e=this.get("type");"user"!=e&&"users"!=e&&"group"!=e&&"groups"!=e&&"role"!=e&&"roles"!=e&&doCallback(b,[new UsergridError("entity must be a group, user, or role","invalid_entity_type"),null,this],this),"user"==e&&null!=this.get("username")?c=this.get("username"):"group"==e&&null!=this.get("name")?c=this.get("name"):null!=this.get("uuid")&&(c=this.get("uuid"));var f=e+"/"+c+"/permissions",g={method:"DELETE",endpoint:f,qs:{permission:a}};this._client.request(g,function(a,c){a&&d._client.logging&&console.log("could not remove permissions"),doCallback(b,[a,c,c.params.permission],d)})},Usergrid.Entity.prototype.getPermissions=function(a){var b=this,c=this.get("type")+"/"+this.get("uuid")+"/permissions",d={method:"GET",endpoint:c};this._client.request(d,function(c,d){c&&b._client.logging&&console.log("could not get user permissions");var e=[];if(d.data){var f=d.data,g=0;for(var h in f){g++;var i=f[h],j=i.split(":"),k="",l=j[0];j.length>1&&(k=j[0],l=j[1]),k=k.replace("*","get,post,put,delete");var m=k.split(","),n={};n.get="no",n.post="no",n.put="no",n["delete"]="no";for(var o in m)n[m[o]]="yes";e.push({operations:n,path:l,perm:i})}}b.permissions=e,doCallback(a,[c,d,d.entities],b)})},Usergrid.Collection=function(a){if(a&&(this._client=a.client,this._type=a.type,this.qs=a.qs||{},this._list=a.list||[],this._iterator=a.iterator||-1,this._previous=a.previous||[],this._next=a.next||null,this._cursor=a.cursor||null,a.list))for(var b=a.list.length,c=0;b>c;c++){var d=this._client.restoreEntity(a.list[c]);this._list[c]=d}},Usergrid.isCollection=function(a){return a&&a instanceof Usergrid.Collection},Usergrid.Collection.prototype.serialize=function(){var a={};a.type=this._type,a.qs=this.qs,a.iterator=this._iterator,a.previous=this._previous,a.next=this._next,a.cursor=this._cursor,this.resetEntityPointer();var b=0;for(a.list=[];this.hasNextEntity();){var c=this.getNextEntity();a.list[b]=c.serialize(),b++}return a=JSON.stringify(a)},Usergrid.Collection.prototype.fetch=function(a){var b=this,c=this.qs;this._cursor?c.cursor=this._cursor:delete c.cursor;var d={method:"GET",endpoint:this._type,qs:this.qs};this._client.request(d,function(c,d){c&&b._client.logging?console.log("error getting collection"):(b.saveCursor(d.cursor||null),b.resetEntityPointer(),b._list=d.getEntities().filter(function(a){return isUUID(a.uuid)}).map(function(a){var c=new Usergrid.Entity({client:b._client});return c.set(a),c.type=b._type,c})),doCallback(a,[c,d,b],b)})},Usergrid.Collection.prototype.addEntity=function(a,b){var c=this;a.type=this._type,this._client.createEntity(a,function(a,d,e){a||c.addExistingEntity(e),doCallback(b,[a,d,c],c)})},Usergrid.Collection.prototype.addExistingEntity=function(a){var b=this._list.length;this._list[b]=a},Usergrid.Collection.prototype.destroyEntity=function(a,b){var c=this;a.destroy(function(d,e){d?(c._client.logging&&console.log("could not destroy entity"),doCallback(b,[d,e,c],c)):c.fetch(b),c.removeEntity(a)})},Usergrid.Collection.prototype.getEntitiesByCriteria=function(a){return this._list.filter(a)},Usergrid.Collection.prototype.getEntityByCriteria=function(a){return this.getEntitiesByCriteria(a).shift()},Usergrid.Collection.prototype.removeEntity=function(a){var b=this.getEntityByCriteria(function(b){return a.uuid===b.get("uuid")});return delete this._list[this._list.indexOf(b)],b},Usergrid.Collection.prototype.getEntityByUUID=function(a,b){var c=this.getEntityByCriteria(function(b){return b.get("uuid")===a});if(c)doCallback(b,[null,c,c],this);else{var d={data:{type:this._type,uuid:a},client:this._client};c=new Usergrid.Entity(d),c.fetch(b)}},Usergrid.Collection.prototype.getFirstEntity=function(){var a=this._list.length;return a>0?this._list[0]:null},Usergrid.Collection.prototype.getLastEntity=function(){var a=this._list.length;return a>0?this._list[a-1]:null},Usergrid.Collection.prototype.hasNextEntity=function(){var a=this._iterator+1,b=a>=0&&a<this._list.length;return b?!0:!1},Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;var a=this._iterator>=0&&this._iterator<=this._list.length;return a?this._list[this._iterator]:!1},Usergrid.Collection.prototype.hasPrevEntity=function(){var a=this._iterator-1,b=a>=0&&a<this._list.length;return b?!0:!1},Usergrid.Collection.prototype.getPrevEntity=function(){this._iterator--;var a=this._iterator>=0&&this._iterator<=this._list.length;return a?this._list[this._iterator]:!1},Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1},Usergrid.Collection.prototype.saveCursor=function(a){this._next!==a&&(this._next=a)},Usergrid.Collection.prototype.resetPaging=function(){this._previous=[],this._next=null,this._cursor=null},Usergrid.Collection.prototype.hasNextPage=function(){return this._next},Usergrid.Collection.prototype.getNextPage=function(a){this.hasNextPage()&&(this._previous.push(this._cursor),this._cursor=this._next,this._list=[],this.fetch(a))},Usergrid.Collection.prototype.hasPreviousPage=function(){return this._previous.length>0},Usergrid.Collection.prototype.getPreviousPage=function(a){this.hasPreviousPage()&&(this._next=null,this._cursor=this._previous.pop(),this._list=[],this.fetch(a))},Usergrid.Group=function(a,b){this._path=a.path,this._list=[],this._client=a.client,this._data=a.data||{},this._data.type="groups"},Usergrid.Group.prototype=new Usergrid.Entity,Usergrid.Group.prototype.fetch=function(a){var b=this,c="groups/"+this._path,d="groups/"+this._path+"/users",e={method:"GET",endpoint:c},f={method:"GET",endpoint:d};this._client.request(e,function(c,d){if(c)b._client.logging&&console.log("error getting group"),doCallback(a,[c,d],b);else{var e=d.getEntities();if(e&&e.length){e.shift();b._client.request(f,function(c,d){c&&b._client.logging?console.log("error getting group users"):b._list=d.getEntities().filter(function(a){return isUUID(a.uuid)}).map(function(a){return new Usergrid.Entity({type:a.type,client:b._client,uuid:a.uuid,response:a})}),doCallback(a,[c,d,b],b)})}}})},Usergrid.Group.prototype.members=function(a){return this._list},Usergrid.Group.prototype.add=function(a,b){var c=this;a.user?(a={method:"POST",endpoint:"groups/"+this._path+"/users/"+a.user.get("username")},this._client.request(a,function(a,d){a?doCallback(b,[a,d,c],c):c.fetch(b)})):doCallback(b,[new UsergridError("no user specified","no_user_specified"),null,this],this)},Usergrid.Group.prototype.remove=function(a,b){var c=this;a.user?(a={method:"DELETE",endpoint:"groups/"+this._path+"/users/"+a.user.username},this._client.request(a,function(a,d){a?doCallback(b,[a,d,c],c):c.fetch(b)})):doCallback(b,[new UsergridError("no user specified","no_user_specified"),null,this],this)},Usergrid.Group.prototype.feed=function(a){var b=this,c={method:"GET",endpoint:"groups/"+this._path+"/feed"};this._client.request(c,function(c,d){doCallback(a,[c,d,b],b)})},Usergrid.Group.prototype.createGroupActivity=function(a,b){var c=this,d=a.user,e=new Usergrid.Entity({client:this._client,data:{actor:{displayName:d.get("username"),uuid:d.get("uuid"),username:d.get("username"),email:d.get("email"),picture:d.get("picture"),image:{duration:0,height:80,url:d.get("picture"),width:80}},verb:"post",content:a.content,type:"groups/"+this._path+"/activities"
}});e.save(function(a,d,e){doCallback(b,[a,d,c])})},Usergrid.Counter=function(a){this._client=a.client,this._data=a.data||{},this._data.category=a.category||"UNKNOWN",this._data.timestamp=a.timestamp||0,this._data.type="events",this._data.counters=a.counters||{}};var COUNTER_RESOLUTIONS=["all","minute","five_minutes","half_hour","hour","six_day","day","week","month"];Usergrid.Counter.prototype=new Usergrid.Entity,Usergrid.Counter.prototype.fetch=function(a){this.getData({},a)},Usergrid.Counter.prototype.increment=function(a,b){var c=this,d=a.name,e=a.value;return d?isNaN(e)?doCallback(b,[new UsergridInvalidArgumentError("'value' for increment, decrement must be a number"),null,c],c):(c._data.counters[d]=parseInt(e)||1,c.save(b)):doCallback(b,[new UsergridInvalidArgumentError("'name' for increment, decrement must be a number"),null,c],c)},Usergrid.Counter.prototype.decrement=function(a,b){var c=this,d=a.name,e=a.value;c.increment({name:d,value:-(parseInt(e)||1)},b)},Usergrid.Counter.prototype.reset=function(a,b){var c=this,d=a.name;c.increment({name:d,value:0},b)},Usergrid.Counter.prototype.getData=function(a,b){var c,d,e=a.start||0,f=a.end||Date.now(),g=(a.resolution||"all").toLowerCase(),h=a.counters||Object.keys(this._data.counters),i=(g||"all").toLowerCase();-1===COUNTER_RESOLUTIONS.indexOf(i)&&(i="all"),c=getSafeTime(e),d=getSafeTime(f);var j=this,k=Object.keys(h).map(function(a){return["counter",encodeURIComponent(h[a])].join("=")});k.push("resolution="+i),k.push("start_time="+String(c)),k.push("end_time="+String(d));var l="counters?"+k.join("&");this._client.request({endpoint:l},function(a,c){return c.counters&&c.counters.length&&c.counters.forEach(function(a){j._data.counters[a.name]=a.value||a.values}),doCallback(b,[a,c,j],j)})},Usergrid.Folder=function(a,b){var c=this;console.log("FOLDER OPTIONS",a),c._client=a.client,c._data=a.data||{},c._data.type="folders";var d=["name","owner","path"].some(function(a){return!(a in c._data)});return d?doCallback(b,[new UsergridInvalidArgumentError("Invalid asset data: 'name', 'owner', and 'path' are required properties."),null,c],c):void c.save(function(a,d){a?doCallback(b,[new UsergridError(d),d,c],c):(d&&d.entities&&d.entities.length&&c.set(d.entities[0]),doCallback(b,[null,d,c],c))})},Usergrid.Folder.prototype=new Usergrid.Entity,Usergrid.Folder.prototype.fetch=function(a){var b=this;Usergrid.Entity.prototype.fetch.call(b,function(c,d){console.log("self",b.get()),console.log("data",d),c?doCallback(a,[null,d,b],b):b.getAssets(function(c,d){c?doCallback(a,[new UsergridError(d),resonse,b],b):doCallback(a,[null,b],b)})})},Usergrid.Folder.prototype.addAsset=function(a,b){var c=this;if("asset"in a){var d=null;switch(typeof a.asset){case"object":d=a.asset,d instanceof Usergrid.Entity||(d=new Usergrid.Asset(d));break;case"string":isUUID(a.asset)&&(d=new Usergrid.Asset({client:c._client,data:{uuid:a.asset,type:"assets"}}))}d&&d instanceof Usergrid.Entity&&d.fetch(function(a,e){if(a)doCallback(b,[new UsergridError(e),e,c],c);else{var f=["folders",c.get("uuid"),"assets",d.get("uuid")].join("/"),g={method:"POST",endpoint:f};c._client.request(g,b)}})}else doCallback(b,[new UsergridInvalidArgumentError("No asset specified"),null,c],c)},Usergrid.Folder.prototype.removeAsset=function(a,b){var c=this;if("asset"in a){var d=null;switch(typeof a.asset){case"object":d=a.asset;break;case"string":isUUID(a.asset)&&(d=new Usergrid.Asset({client:c._client,data:{uuid:a.asset,type:"assets"}}))}if(d&&null!==d){var e=["folders",c.get("uuid"),"assets",d.get("uuid")].join("/");c._client.request({method:"DELETE",endpoint:e},function(a,d){a?doCallback(b,[new UsergridError(d),d,c],c):doCallback(b,[null,d,c],c)})}}else doCallback(b,[new UsergridInvalidArgumentError("No asset specified"),null,c],c)},Usergrid.Folder.prototype.getAssets=function(a){return this.getConnections("assets",a)},XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(a){for(var b=a.length,c=new Uint8Array(b),d=0;b>d;d++)c[d]=255&a.charCodeAt(d);this.send(c)}),Usergrid.Asset=function(a,b){var c=this;c._client=a.client,c._data=a.data||{},c._data.type="assets";var d=["name","owner","path"].some(function(a){return!(a in c._data)});d?doCallback(b,[new UsergridError("Invalid asset data: 'name', 'owner', and 'path' are required properties."),null,c],c):c.save(function(a,d){a?doCallback(b,[new UsergridError(d),d,c],c):(d&&d.entities&&d.entities.length&&c.set(d.entities[0]),doCallback(b,[null,d,c],c))})},Usergrid.Asset.prototype=new Usergrid.Entity,Usergrid.Asset.prototype.addToFolder=function(a,b){var c=this;if("folder"in a&&isUUID(a.folder)){Usergrid.Folder({uuid:a.folder},function(a,d){if(a)doCallback(b,[UsergridError.fromResponse(d),d,c],c);else{var e=["folders",d.get("uuid"),"assets",c.get("uuid")].join("/"),f={method:"POST",endpoint:e};this._client.request(f,function(a,e){a?doCallback(b,[UsergridError.fromResponse(d),e,c],c):doCallback(b,[null,d,c],c)})}})}else doCallback(b,[new UsergridError("folder not specified"),null,c],c)},Usergrid.Entity.prototype.attachAsset=function(a,b){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return void doCallback(b,[new UsergridError("The File APIs are not fully supported by your browser."),null,this],this);var c=this,d=arguments,e=this._data.type,f=c.get("attempts");if(isNaN(f)&&(f=3),"assets"!=e&&"asset"!=e)var g=[this._client.URI,this._client.orgName,this._client.appName,e,c.get("uuid")].join("/");else{c.set("content-type",a.type),c.set("size",a.size);var g=[this._client.URI,this._client.orgName,this._client.appName,"assets",c.get("uuid"),"data"].join("/")}var h=new XMLHttpRequest;h.open("POST",g,!0),h.onerror=function(a){doCallback(b,[new UsergridError("The File APIs are not fully supported by your browser.")],h,c)},h.onload=function(a){h.status>=500&&f>0?(c.set("attempts",--f),setTimeout(function(){c.attachAsset.apply(c,d)},100)):h.status>=300?(c.set("attempts"),doCallback(b,[new UsergridError(JSON.parse(h.responseText)),h,c],c)):(c.set("attempts"),c.fetch(),doCallback(b,[null,h,c],c))};var i=new FileReader;i.onload=function(){var a=i.result;("assets"===e||"asset"===e)&&(h.overrideMimeType("application/octet-stream"),h.setRequestHeader("Content-Type","application/octet-stream")),h.sendAsBinary(a)},i.readAsBinaryString(a)},Usergrid.Asset.prototype.upload=function(a,b){this.attachAsset(a,function(a,c){a?doCallback(b,[new UsergridError(a),c,self],self):doCallback(b,[null,c,self],self)})},Usergrid.Entity.prototype.downloadAsset=function(a){var b,c=this,d=this._data.type,e=new XMLHttpRequest;b="assets"!=d&&"asset"!=d?[this._client.URI,this._client.orgName,this._client.appName,d,c.get("uuid")].join("/"):[this._client.URI,this._client.orgName,this._client.appName,"assets",c.get("uuid"),"data"].join("/"),e.open("GET",b,!0),e.responseType="blob",e.onload=function(b){var f=e.response;"assets"!=d&&"asset"!=d?doCallback(a,[null,f,e],c):doCallback(a,[null,e,c],c)},e.onerror=function(b){a(!0,b),doCallback(a,[new UsergridError(b),e,c],c)},"assets"!=d&&"asset"!=d?e.setRequestHeader("Accept",c._data["file-metadata"]["content-type"]):e.overrideMimeType(c.get("content-type")),e.send()},Usergrid.Asset.prototype.download=function(a){this.downloadAsset(function(b,c){b?doCallback(a,[new UsergridError(b),c,self],self):doCallback(a,[null,c,self],self)})},function(a){function b(a,b,c,d,e){this.message=a,this.name=b,this.timestamp=c||Date.now(),this.duration=d||0,this.exception=e}function c(a,b,c,d,e){this.message=a,this.name=b,this.timestamp=c||Date.now(),this.duration=d||0,this.exception=e}function d(a,b,c,d,e){this.message=a,this.name=b||"invalid_http_method",this.timestamp=c||Date.now(),this.duration=d||0,this.exception=e}function e(a,b,c,d,e){this.message=a,this.name=b||"invalid_uri",this.timestamp=c||Date.now(),this.duration=d||0,this.exception=e}function f(a,b,c,d,e){this.message=a,this.name=b||"invalid_argument",this.timestamp=c||Date.now(),this.duration=d||0,this.exception=e}function g(a,b,c,d,e){this.message=a,this.name=b,this.timestamp=c||Date.now(),this.duration=d||0,this.exception=e}var h,i="UsergridError",j=a[i],k=h&&void 0!==h?a[h]:void 0;return b.prototype=new Error,b.prototype.constructor=b,b.fromResponse=function(a){return a&&"undefined"!=typeof a?new b(a.error_description,a.error,a.timestamp,a.duration,a.exception):new b},b.createSubClass=function(c){return c in a&&a[c]?a[c]:(a[c]=function(){},a[c].name=c,a[c].prototype=new b,a[c])},c.prototype=new b,d.prototype=new b,e.prototype=new b,f.prototype=new b,g.prototype=new b,a.UsergridHTTPResponseError=c,a.UsergridInvalidHTTPMethodError=d,a.UsergridInvalidURIError=e,a.UsergridInvalidArgumentError=f,a.UsergridKeystoreDatabaseUpgradeNeededError=g,a[i]=b,void 0!==h&&(a[h]=b),a[i].noConflict=function(){return j&&(a[i]=j),void 0!==h&&(a[h]=k),b},a[i]}(this),function(){function a(a){var b=a||{},d={logLevel:p.assert,logMessage:b.logMessage,tag:b.tag,timeStamp:c()};t.push(d)}function b(){var a,b=[],c="0123456789ABCDEF";for(a=0;36>a;a++)b[a]=Math.floor(16*Math.random());for(b[14]=4,b[19]=3&b[19]|8,a=0;36>a;a++)b[a]=c[b[a]];return b[8]=b[13]=b[18]=b[23]="-",b.join("")}function c(){return(new Date).getTime().toString()}function d(){var a="UNKNOWN";try{if("undefined"==typeof localStorage)throw new Error("device or platform does not support local storage");null===window.localStorage.getItem("uuid")&&window.localStorage.setItem("uuid",b()),a=window.localStorage.getItem("uuid")}catch(c){a=b(),console.warn(c)}finally{return a}}function e(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof window.device}function f(){return"undefined"!=typeof window.forge}function g(){return"undefined"!=typeof Titanium}function h(a){return new RegExp("\\b("+a+")\\/([^\\s]+)")}function i(a,b,c){var d=w[b].exec(a);return c=c||[],d&&d.length&&!c.some(function(b){return w[b].exec(a)})?d.slice(1,3):void 0}function j(a,b){var c=b,d=r,e={devicePlatform:r,deviceOSVersion:r},e=x.reduce(function(a,b){return b?b:a},"UNKNOWN");return c=e[0],d=e[1],"MSIE"===c&&(c="Microsoft Internet Explorer"),e.devicePlatform=c,e.deviceOSVersion=d,e}var k="Apigee",l=this,m=l[k],n=n||l.Usergrid;if(!n)throw"Usergrid module is required for the monitoring module.";var o={get:"GET",post:"POST",put:"PUT",del:"DELETE",head:"HEAD"},p={verbose:"V",debug:"D",info:"I",warn:"W",error:"E",assert:"A"},q={verbose:2,debug:3,info:4,warn:5,error:6,assert:7},r="UNKNOWN",s="JavaScript",t=[],u=[],v=Object.keys(n).reduce(function(a,b){return n.hasOwnProperty(b)&&(a[b]=n[b]),a},function(){});v.Client=function(a){if(this.monitoringEnabled=a.monitoringEnabled||!0,this.monitoringEnabled)try{this.monitor=new v.MonitoringClient(a)}catch(b){console.log(b)}n.Client.call(this,a)},v.Client.prototype=n.Client.prototype,n.Client.prototype.getDeviceUUID=function(){if("string"==typeof window.localStorage.getItem("deviceUUID"))return window.localStorage.getItem("deviceUUID");var a=b();return window.localStorage.setItem("deviceUUID",a),window.localStorage.getItem("deviceUUID")},n.Client.prototype.registerDevice=function(a,b){if(a){var c=a.notifier+".notifier.id",d={type:"devices",uuid:this.getDeviceUUID()};d[c]=a.deviceToken;var e={client:this,data:d},f=new n.Entity(e);f.save(b)}else b(!0)},n.Client.prototype.sendPushToDevice=function(a,b){if(a){var c=a.notifier,d={type:"notifier",name:a.notifier},e=this;this.getEntity(d,function(d,f){if(d)b(d,f);else{var g={type:a.path};"google"===f.get("provider")?(g.payloads={},g.payloads[c]=a.message):"apple"===f.get("provider")&&(g.payloads={},g.payloads[c]={aps:{alert:a.message,sound:a.sound}});var h={client:e,data:g},i=new n.Entity(h);i.save(b)}})}else b(!0)},v.MonitoringClient=function(a){var b=this;if(this.orgName=a.orgName,this.appName=a.appName,this.syncOnClose=a.syncOnClose||!1,this.testMode=a.testMode||!1,this.URI="undefined"==typeof a.URI?"https://api.usergrid.com":a.URI,this.syncDate=c(),"undefined"!=typeof a.config?(this.configuration=a.config,this.configuration.deviceLevelOverrideEnabled===!0?this.deviceConfig=this.configuration.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?this.deviceConfig=this.configuration.abtestingAppConfig:this.deviceConfig=this.configuration.defaultAppConfig):(this.configuration=null,this.downloadConfig()),null!==this.configuration&&"undefined"!==this.configuration){var d=0;if(this.deviceConfig.samplingRate<100&&(d=Math.floor(101*Math.random())),d<this.deviceConfig.samplingRate){this.appId=this.configuration.instaOpsApplicationId,this.appConfigType=this.deviceConfig.appConfigType,this.deviceConfig.enableLogMonitoring&&this.patchLoggingCalls();var h=3e3;"undefined"!=typeof this.deviceConfig.agentUploadIntervalInSeconds&&(h=1e3*this.deviceConfig.agentUploadIntervalInSeconds),this.syncOnClose?e()?window.addEventListener("pause",function(){b.prepareSync()},!1):f()?forge.event.appPaused.addListener(function(a){},function(a){console.log("Error syncing data."),console.log(a)}):g()||window.addEventListener("beforeunload",function(a){b.prepareSync()}):setInterval(function(){b.prepareSync()},h),this.deviceConfig.networkMonitoringEnabled&&this.patchNetworkCalls(XMLHttpRequest),window.onerror=v.MonitoringClient.catchCrashReport,this.startSession(),this.sync({})}}else console.log("Error: Apigee APM configuration unavailable.")},v.MonitoringClient.prototype.applyMonkeyPatches=function(){var a=this;a.deviceConfig.enableLogMonitoring&&a.patchLoggingCalls(),a.deviceConfig.networkMonitoringEnabled&&a.patchNetworkCalls(XMLHttpRequest)},v.MonitoringClient.prototype.getConfig=function(a,b){"undefined"!=typeof a.config?(this.configuration=a.config,this.configuration.deviceLevelOverrideEnabled===!0?this.deviceConfig=this.configuration.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?this.deviceConfig=this.configuration.abtestingAppConfig:this.deviceConfig=this.configuration.defaultAppConfig,b(this.deviceConfig)):(this.configuration=null,this.downloadConfig(b))},v.MonitoringClient.prototype.downloadConfig=function(a){function b(){if(4===c.readyState)if("function"==typeof a)200===c.status?a(null,JSON.parse(c.responseText)):a(c.statusText);else if(200===c.status){var b=JSON.parse(c.responseText);e.configuration=b,b.deviceLevelOverrideEnabled===!0?e.deviceConfig=b.deviceLevelAppConfig:e.abtestingOverrideEnabled===!0?e.deviceConfig=b.abtestingAppConfig:e.deviceConfig=b.defaultAppConfig}}var c=new XMLHttpRequest,d=this.URI+"/"+this.orgName+"/"+this.appName+"/apm/apigeeMobileConfig";"function"==typeof a?c.open(o.get,d,!0):c.open(o.get,d,!1);var e=this;c.setRequestHeader("Accept","application/json"),c.setRequestHeader("Content-Type","application/json"),c.onreadystatechange=b,c.send()},v.MonitoringClient.prototype.sync=function(a){var b={};b.logs=a.logs,b.metrics=a.metrics,b.sessionMetrics=this.sessionMetrics,b.orgName=this.orgName,b.appName=this.appName,b.fullAppName=this.orgName+"_"+this.appName,b.instaOpsApplicationId=this.configuration.instaOpsApplicationId,b.timeStamp=c();var d=new XMLHttpRequest,e=this.URI+"/"+this.orgName+"/"+this.appName+"/apm/apmMetrics";if(d.open(o.post,e,!1),d.setRequestHeader("Accept","application/json"),d.setRequestHeader("Content-Type","application/json"),d.send(JSON.stringify(b)),200===d.status){t=[],u=[];d.responseText}else console.log("Error syncing"),console.log(d.responseText)},v.MonitoringClient.catchCrashReport=function(b,c,d){a({tag:"CRASH",logMessage:"Error:"+b+" for url:"+c+" on line:"+d})},v.MonitoringClient.prototype.startLocationCapture=function(){var a=this;if(a.deviceConfig.locationCaptureEnabled&&"undefined"!=typeof navigator.geolocation){var b=function(b){a.sessionMetrics.latitude=b.coords.latitude,a.sessionMetrics.longitude=b.coords.longitude},c=function(){console.log("Location access is not available.")};navigator.geolocation.getCurrentPosition(b,c)}},v.MonitoringClient.prototype.detectAppPlatform=function(a){var b=this,c=function(c){a.devicePlatform=c.name,a.deviceOSVersion=c.osname,b.deviceConfig.deviceIdCaptureEnabled?b.deviceConfig.obfuscateDeviceId?a.deviceId=d():a.deviceId=c.uuid:this.deviceConfig.obfuscateDeviceId?a.deviceId=d():a.deviceId=r,a.deviceModel=c.model,a.networkType=c.networkType},h=function(c){return"device"in window?(a.devicePlatform=window.device.platform,a.deviceOSVersion=window.device.version,a.deviceModel=window.device.name):window.cordova&&(a.devicePlatform=window.cordova.platformId,a.deviceOSVersion=r,a.deviceModel=r),"connection"in navigator&&(a.networkType=navigator.connection.type||r),b.deviceConfig.deviceIdCaptureEnabled?b.deviceConfig.obfuscateDeviceId?a.deviceId=d():a.deviceId=window.device.uuid:this.deviceConfig.obfuscateDeviceId?a.deviceId=d():a.deviceId=r,a},i=function(a){var c=r;return forge.is.ios()?c="iOS":forge.is.android()&&(c="Android"),a.devicePlatform=r,a.deviceOSVersion=c,b.deviceConfig.deviceIdCaptureEnabled?a.deviceId=d():a.deviceId=r,a.deviceModel=r,a.networkType=forge.is.connection.wifi()?"WIFI":r,a};if(e())a=h(a);else if(f())a=i(a);else if(g())Ti.App.addEventListener("analytics:platformMetrics",c);else if("undefined"!=typeof window.localStorage&&b.deviceConfig.deviceIdCaptureEnabled&&(a.deviceId=d()),"undefined"!=typeof navigator.userAgent){var k=j(navigator.userAgent,navigator.appName);a.devicePlatform=k.devicePlatform,a.deviceOSVersion=k.deviceOSVersion,"undefined"!=typeof navigator.language&&(a.localLanguage=navigator.language)}return g()&&Ti.App.fireEvent("analytics:attachReady"),a},v.MonitoringClient.prototype.startSession=function(){if(null!==this.configuration&&"undefined"!==this.configuration){var a=this,d={};d.timeStamp=c(),d.appConfigType=this.appConfigType,d.appId=this.appId.toString(),d.applicationVersion="undefined"!=typeof this.appVersion?this.appVersion.toString():r,d.batteryLevel="-100",d.deviceCountry=r,d.deviceId=r,d.deviceModel=r,d.deviceOSVersion=r,d.devicePlatform=r,d.localCountry=r,d.localLanguage=r,d.networkCarrier=r,d.networkCountry=r,d.networkSubType=r,d.networkType=r,d.sdkType=s,d.sessionId=b(),d.sessionStartTime=d.timeStamp,a.startLocationCapture(),a.sessionMetrics=a.detectAppPlatform(d)}},v.MonitoringClient.prototype.patchNetworkCalls=function(a){"use strict";var d=this,e=a.prototype.open,f=a.prototype.send;a.prototype.open=function(a,c,f,g,h){this._method=a,this._url=c,e.call(this,a,c,f,g,h),function(a){a.setRequestHeader("X-Apigee-Client-Device-Id",d.sessionMetrics.deviceId),a.setRequestHeader("X-Apigee-Client-Session-Id",d.sessionMetrics.sessionId),a.setRequestHeader("X-Apigee-Client-Org-Name",d.orgName),a.setRequestHeader("X-Apigee-Client-App-Name",d.appName),a.setRequestHeader("X-Apigee-Client-Request-Id",b())}(this)},a.prototype.send=function(a){function b(){if(4==h.readyState){var a=d.getMonitoringURL();if(-1===i.indexOf("/!gap_exec")&&-1===i.indexOf(a)){var b=c(),f=b-e,j={url:i,startTime:e.toString(),endTime:b.toString(),numSamples:"1",latency:f.toString(),timeStamp:e.toString(),httpStatusCode:h.status.toString(),responseDataSize:h.responseText.length.toString()};200==h.status?(j.numErrors="0",d.logNetworkCall(j)):(j.numErrors="1",d.logNetworkCall(j))}}g&&g()}var e,g,h=this,i=(this._method,this._url);this.noIntercept||(e=c(),this.addEventListener?this.addEventListener("readystatechange",b,!1):(g=this.onreadystatechange,this.onreadystatechange=b)),f.call(this,a)}},v.MonitoringClient.prototype.patchLoggingCalls=function(){var a=this,b=window.console;if(window.console={log:function(){a.logInfo({tag:"CONSOLE",logMessage:arguments[0]}),b.log.apply(b,arguments)},warn:function(){a.logWarn({tag:"CONSOLE",logMessage:arguments[0]}),b.warn.apply(b,arguments)},error:function(){a.logError({tag:"CONSOLE",logMessage:arguments[0]}),b.error.apply(b,arguments)},assert:function(){a.logAssert({tag:"CONSOLE",logMessage:arguments[1]}),b.assert.apply(b,arguments)},debug:function(){a.logDebug({tag:"CONSOLE",logMessage:arguments[0]}),b.debug.apply(b,arguments)}},g()){var c=Ti.API;window.console.log=function(){c.info.apply(c,arguments)},Ti.API={info:function(){a.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[0]}),c.info.apply(c,arguments)},log:function(){var b=arguments[0];"info"===b?a.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"warn"===b?a.logWarn({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"error"===b?a.logError({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"debug"===b?a.logDebug({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"trace"===b?a.logAssert({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):a.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}),c.log.apply(c,arguments)}}}},v.MonitoringClient.prototype.prepareSync=function(){var a={},b=this;"undefined"!=typeof b.sessionMetrics&&(a.sessionMetrics=b.sessionMetrics);var d=!1;this.syncDate=c(),u.length>0&&(d=!0),t.length>0&&(d=!0),a.logs=t,a.metrics=u,d&&!b.testMode&&this.sync(a)},v.MonitoringClient.prototype.logMessage=function(a){var b=a||{},d={logLevel:b.logLevel,logMessage:b.logMessage.substring(0,250),tag:b.tag,timeStamp:c()};t.push(d)},v.MonitoringClient.prototype.logVerbose=function(a){var b=a||{};b.logLevel=p.verbose,this.deviceConfig.logLevelToMonitor>=q.verbose&&this.logMessage(a)},v.MonitoringClient.prototype.logDebug=function(a){var b=a||{};b.logLevel=p.debug,this.deviceConfig.logLevelToMonitor>=q.debug&&this.logMessage(a)},v.MonitoringClient.prototype.logInfo=function(a){var b=a||{};b.logLevel=p.info,this.deviceConfig.logLevelToMonitor>=q.info&&this.logMessage(a)},v.MonitoringClient.prototype.logWarn=function(a){var b=a||{};b.logLevel=p.warn,this.deviceConfig.logLevelToMonitor>=q.warn&&this.logMessage(a)},v.MonitoringClient.prototype.logError=function(a){var b=a||{};b.logLevel=p.error,this.deviceConfig.logLevelToMonitor>=q.error&&this.logMessage(a)},v.MonitoringClient.prototype.logAssert=function(a){var b=a||{};b.logLevel=p.assert,this.deviceConfig.logLevelToMonitor>=q.assert&&this.logMessage(a)},v.MonitoringClient.prototype.logNetworkCall=function(a){u.push(a)},v.MonitoringClient.prototype.getMonitoringURL=function(){return this.URI+"/"+this.orgName+"/"+this.appName+"/apm/"},v.MonitoringClient.prototype.getConfig=function(a){},v.MonitoringClient.prototype.logs=function(){return t},v.MonitoringClient.prototype.metrics=function(){return u},v.MonitoringClient.prototype.getSessionMetrics=function(){return this.sessionMetrics},v.MonitoringClient.prototype.clearMetrics=function(){t=[],u=[]},v.MonitoringClient.prototype.mixin=function(a){for(var b=["bind","unbind","trigger"],c=0;c<b.length;c++)a.prototype[b[c]]=MicroEvent.prototype[b[c]]};var w=["Seamonkey","Firefox","Chromium","Chrome","Safari","Opera"].reduce(function(a,b){return a[b]=h(b),a},{});w.MSIE=new RegExp(";(MSIE) ([^\\s]+)");var x=[["MSIE"],["Opera",[]],["Seamonkey",[]],["Firefox",["Seamonkey"]],["Chromium",[]],["Chrome",["Chromium"]],["Safari",["Chromium","Chrome"]]].map(function(a){return i(navigator.userAgent,a[0],a[1])});return l[k]=v,l[k].noConflict=function(){return m&&(l[k]=m),v},l[k]}(),function(){var a="Apigee",b=this,c=b[a],d=d||b.Apigee;if(!d)throw"Apigee module is required for the monitoring module.";return d.Client.prototype.logVerbose=function(a){this.monitor.logVerbose(a)},d.Client.prototype.logDebug=function(a){this.monitor.logDebug(a)},d.Client.prototype.logInfo=function(a){this.monitor.logInfo(a)},d.Client.prototype.logWarn=function(a){this.monitor.logWarn(a)},d.Client.prototype.logError=function(a){this.monitor.logError(a)},d.Client.prototype.logAssert=function(a){this.monitor.logAssert(a)},b[a]=d,b[a].noConflict=function(){return c&&(b[a]=c),Usergrid},b[a]}(),$(document).ready(function(){function a(){var a={type:"animal"};console.log("getEntity"),k.getEntity(a,function(a,c){a?(console.log("Get Error: "+a),b()):(console.log("Get Result: "+c),j=c.entities[0].uuid)}),f(h()),$("#reset-button").on("click",c),$("#add-button").on("click",d)}function b(){var a={type:"animal",data:"test"};k.createEntity(a,function(a,b){a?console.log("Create Error: "+a):console.log("Create Result: "+b)})}function c(a){g(i()),f(h()),a.preventDefault()}function d(a){var b=$("#animal-name").val(),c=$("#animal-description").val(),d=$("#animal-size").val(),i=$("#animal-birth").val(),j=$("#animal-image-url").val(),k={name:b,description:c,size:d,birthDate:i,imageUrl:j},l=h();l.kittens.unshift(k),g(l),f(h()),e(),a.preventDefault()}function e(){$("#animal-name").val(""),$("#animal-description").val(""),$("#animal-size").val(""),$("#animal-birth").val(""),$("#animal-image-url").val("")}function f(a){var b=$("#kitten-list");b.html(" "),$.each(a.kittens,function(a,c){b.append("<div class='panel panel-default'><div class='panel-heading'>"+c.name+"</div><div class='panel-body'><img class='thumbnail' src='"+c.imageUrl+"' alt=''>"+c.description+"<br>Size: "+c.size+"<br>Birth date: "+c.birthDate+"</div></div>")})}function g(a){localStorage.setItem("aaaAnimals",JSON.stringify(a))}function h(){var a=localStorage.getItem("aaaAnimals");return null===a?i():JSON.parse(a)}function i(){var a={kittens:[{name:"Simba",description:"Simba made the transition from the printed page to the television screen during the 1960s. It is very difficult to find homes for line drawings like Simba, so we hope to find that special family who will take this Japanese sweetheart into their hearts and color inside the lines.",size:"Animated",birthDate:"1950",imageUrl:"images/simba_th.jpg"},{name:"Baby",description:"Baby is a leopard, imported from South America by the fictional brother of Katharine Hepburn. Though he has a reputation for eating car upholstery and trucks full of chickens, we think that he could be a wonderful housepet for  the right madcap heroine and/or paleontologist",size:"Medium",birthDate:"1938",imageUrl:"images/baby_th.gif"},{name:"Tigger",description:"Originally a character in a children's book, before Disney brought him unwelcome fame and attention, Tigger is now looking for a quiet home where he can live out of the public eye and not have to leap in the air all the time. He would prefer to be the only cat, and especially would like to avoid homes with fat honey-obsessed bears",size:"Medium",birthDate:"1924",imageUrl:"images/tigger_th.png"},{name:"Jespah, Gopa and Little Elsa",description:"These three siblings must be adopted together, and allowed to live free. They will grow to be as much as 500 pounds each. If you're interested in adopting this lovable trio, please be aware that each one will eat as much as 90 pounds of meat at every meal -- preferably zebra, antelope or buffalo.  So budget accordingly!",size:"Very, very large",birthDate:"1966",imageUrl:"images/bornfree_th.jpg"},{name:"Grumpy Cat",description:"Grumpy Cat is a notoriously foul-tempered feline, with world-wide renown, prone to complaining about everything and everyone in his life. His new Forever Friend will need a strong sense of self-esteem and a willingness to be groused about in public.",size:"Small",birthDate:"2012",imageUrl:"images/grumpy_th.jpg"},{name:"Simba 2",description:"Simba was orphaned at an early age and would like to find a new home free from family dysfunction or murderous relatives. He gets along well with other animals,especially meerkats and warthogs",size:"Mighty",birthDate:"1994",imageUrl:"images/lionking_th.jpg"}]};return a}var j,k=new Usergrid.Client({orgName:"larsj",appName:"sandbox",logging:!0,buildCurl:!0});a()});